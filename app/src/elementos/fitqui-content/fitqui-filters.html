<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../../bower_components/paper-radio-group/paper-radio-group.html">
<link rel="import" href="../../../bower_components/paper-radio-button/paper-radio-button.html">
<link rel="import" href="../../../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../../../bower_components/iron-form/iron-form.html">
<link rel="import" href="../../../bower_components/paper-toast/paper-toast.html">
<link rel="import" href="../fitqui-shared-styles.html">
<link rel="import" href="fitqui-filters-behavior.html">

<dom-module id="fitqui-filters">
  <template>
    <style include="fitqui-shared-styles"></style>
    <link rel="stylesheet" type="text/css" href="../../css/fitqui-app/fitqui-content/fitqui-filters.css" inline>

    <div id="wrapper" class="">
      <h1>Preferências</h1>
      <p>De acordo com suas preferências abaixo, tentaremos criar o melhor treino para você.</p>
      <form is="iron-form" id="formulario">
        <label for="dificuldade">Dificuldade: </label>
        <paper-radio-group id="dificuldade" selected="iniciante">
          <paper-radio-button name="iniciante">Iniciante</paper-radio-button>
          <paper-radio-button name="intermediario">Intermediário</paper-radio-button>
          <paper-radio-button name="avancado">Avançado</paper-radio-button>
        </paper-radio-group>
        <paper-input
          label="Duração do treino"
          prevent-invalid-input
          allowed-pattern="[0-9]"
          name="duracao">
          <iron-icon icon="icones:timer" prefix></iron-icon>
          <div suffix>minutos</div>
        </paper-input>
        <paper-checkbox name="aerobico" checked={{usarAerobico}}>Adicionar exercícios aeróbicos</paper-checkbox>
        <div id="local" hidden={{!usarAerobico}}>
          <label for="local">Onde: </label>
          <paper-radio-group id="local" selected="casa">
            <paper-radio-button name="casa">Em casa</paper-radio-button>
            <paper-radio-button name="parque">No parque</paper-radio-button>
          </paper-radio-group>
        </div>
        <div id="musculos">
          <label for="musculos">Grupos musculares: </label>
          <paper-checkbox name="quadriceps">Quadríceps</paper-checkbox>
          <paper-checkbox name="panturrilha">Panturrilha</paper-checkbox>
          <paper-checkbox name="gluteo">Glúteo</paper-checkbox>
          <paper-checkbox name="trapezio">Trapézio</paper-checkbox>
          <paper-checkbox name="ombros">Ombros</paper-checkbox>
          <paper-checkbox name="biceps">Biceps</paper-checkbox>
          <paper-checkbox name="triceps">Triceps</paper-checkbox>
          <paper-checkbox name="antebraco">Antebraço</paper-checkbox>
          <paper-checkbox name="peito">Peito</paper-checkbox>
          <paper-checkbox name="abdomen">Abdômen</paper-checkbox>
          <paper-checkbox name="costas">Costas</paper-checkbox>
        </div>
        <paper-button id="proximo" raised>Próximo</paper-button>
      </form>
    </div>

    <paper-toast id="toastFixo" duration="0" text=""><paper-button onclick="toastFixo.toggle()">X</paper-button></paper-toast>

  </template>
  <script>
    Polymer({
      is: 'fitqui-filters',
      properties: {
        dados: {
          type: Array,
          notify: true
        }
      },
      behaviors: [FitquiFiltersBehavior],
      listeners: {
        'proximo.tap': 'irSelector'
      },
      irSelector: function(){
        var spinner = document.querySelector('fitqui-spinner#spinner');
        spinner.setAttribute("ativado",true);
        var usuario = firebase.auth().currentUser;
        if (!usuario) {
          firebase.auth().signInAnonymously().then(resposta => {
            this.prepararDados();
          },erro => {
            var msg = "Erro ao registrar usuario de forma anonima; errorCode: " + erro.code + "; errorMessage: " + erro.message + ";";
            ga('send','exception',{
              'exDescription': msg,
              'exFatal': false
            });
            this.prepararDados();
          });
        } else {
          this.prepararDados();
        }
      },
      prepararDados: function(){
        var dadosForm = this.$.formulario.serialize();
        this.prepararExercicios(dadosForm);
      },
      proximo: function(){
        var spinner = document.querySelector('fitqui-spinner#spinner');
        spinner.removeAttribute("ativado");
        window.location.href = "#selector";
      }
    });
  </script>
</dom-module>
