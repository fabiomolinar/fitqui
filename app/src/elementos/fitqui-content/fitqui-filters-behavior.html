<script>
  FitquiFiltersBehavior = {
    properties: {
      niveis: {
        type: Array,
        value: () => ['iniciante','intermediario','avancado']
      },
      locais: {
        type: Array,
        value: () => ['casa','parque']
      },
      duracaoMin: {
        type: Number,
        value: () => 10
      },
      duracaoMax: {
        type: Number,
        value: () => 45
      },
      numSeries: {
        type: Number,
        value: () => 3
      }
    },
    prepararExercicios: function(dados){
      /*
      *-----Valores iniciais
      *-nivel: nivel de dificuldade
      *-duracao: duracao total dos exercicios; quanto tempo o usuario quer se exercitar
      *-aerobico: se é preciso adicionar exercicios aerobicos
      *-quantidade: quantidade de exercicios total
      */
      var configuracao = {
        nivel: "iniciante",
        duracao: this.duracaoMin,
        aerobico: false,
        local: 'casa',
        quantidade: 3
      }
      var exercicios = [];
      var todosExercicios = [];
      configuracao = this.processarConfiguracao(dados, configuracao);
      todosExercicios = this.pegarTodosExercicios(configuracao);
      for (var i = 0; i < this.numSeries; i++) {
        exercicios.push(this.criarExercicio(configuracao,todosExercicios));
      }
      return exercicios;
    },
    criarExercicio: function(configuracao, todos){
      //Retorna uma serie aleatoria de exercicios baseado na configuracao e na lista de todos exercicios possiveis
      //Sempre retornar um exercicio de warmup no comeco e um de cooldown no final
    },
    pegarTodosExercicios: function(configuracao){
      //Retorna uma array com todos os exercicios possiveis que obedecem a configuracao
      var dbExercicios = firebase.database().ref('exercicios');
      dbExercicios.once('value', snap => {
        if (snap.val()) {
          console.log(snap.val());
          this.proximo();
        } else {
          var msg = "Nenhum valor retornado do banco de dados. Em fitqui-filters-behavior.html."
          this.databaseError(msg);
        }
      }, erro => {
        var msg = "não foi possível pegar os exercícios na base de dados. Em fitqui-filters-behavior.html; erro.message: " + erro.message + ".";
        this.databaseError(msg);
      }, this);
    },
    processarConfiguracao: function(dados, configuracao){
      var niveis = this.niveis;
      var locais = this.locais;
      for (var i = 0; i < niveis.length; i++) {
        if (dados.hasOwnProperty(niveis[i])) {
          configuracao.nivel = niveis[i];
          break;
        }
      }
      if (dados.hasOwnProperty('aerobico')) {
        configuracao.aerobico = true;
        for (var i = 0; i < locais.length; i++) {
          if (dados.hasOwnProperty(locais[i])) {
            configuracao.local = locais[i];
            break;
          }
        }
      }
      if (configuracao.aerobico === true) {
        this.duracaoMin = 20;
      }
      switch (configuracao.nivel) {
        case 'iniciante':
          this.duracaoMax = configuracao.aerobico === true ? 45 : 45;
          break;
        case 'intermediario':
          this.duracaoMax = configuracao.aerobico === true ? 90 : 60;
          break;
        case 'avancado':
          this.duracaoMax = configuracao.aerobico === true ? 120 : 90;
          break;
        default:
          this.duracaoMax = 45;
          ga('send','exception',{
            'exDescription': 'tipo de nivel nao encontrado na lista de niveis no fitqui-filters-behavior.html',
            'exFatal': false
          });
      }
      configuracao.duracao = this.duracaoMin;
      if (!(isNaN(parseInt(dados.duracao)))) {
        var duracao = parseInt(dados.duracao);
        if (duracao < this.duracaoMin) {
          configuracao.duracao = this.duracaoMin;
        } else if (duracao > this.duracaoMax) {
          configuracao.duracao = this.duracaoMax;
        } else {
          configuracao.duracao = duracao;
        }
      }
      return configuracao;
    },
    databaseError: function(msg){
      ga('send','exception',{
        'exDescription': msg,
        'exFatal': false
      });
      var spinner = document.querySelector('fitqui-spinner#spinner');
      spinner.removeAttribute("ativado");
      this.$.toastFixo.text = "Ops, alguma coisa deu errada. Tente novamente mais tarde.";
      this.$.toastFixo.show();
    }
  }
</script>
